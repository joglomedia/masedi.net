/**
 * Quick Comments for WordPress
 * Post comments quickly without leaving or refreshing the page.
 * @name quick-comments-0.7.0.min.js
 * @author wokamoto - http://dogmap.jp
 * @version 0.7.0
 * @date December 15, 2008
 * @copyright (c) 2008 wokamoto (dogmap.jp)
 * @license  Released under the GPL license (http://www.gnu.org/copyleft/gpl.html)
 * @requires jQuery v1.2.3 or later and jQuery.blockUI v2.08 or later and jQuery.ScrollTo V1.4 or later
 */
if(typeof jQuery!=="undefined"){jQuery((function(I){var E=I.extend({form:"form#commentform",list:"ol.commentlist:first",requireNameEmail:false,errMsgNameEmail:"Error: please fill the required fields (name, email).",errMsgCommentNone:"Error: please type a comment.",errMsgEmail:"Error: please enter a valid email address.",message:"wait...",message2:"loading...",loader:"ajax-loader.gif",messageCSS:{border:"1px solid #8C8C8C",font:"normal 12px Arial"},overlayCSS:{backgroundColor:"#FFF",opacity:"0.6"},effect:0,speed:"fast",update:"/wp-content/plugins/quick-comments/quick-comments.php",editReturn:"#edit-comment-%ID%",editOffset:-50,editButtonLabel:"Update Comment",editDisabled:{author:true,email:true,url:true}},quickCommentsL10n);var N=I.browser.msie;var O=N&&I.browser.version<"7.0";var B=I(E.form).unbind("submit");var D={position:B.css("position")};var Q=I(E.list);var U={zoom:Q.css("zoom")};var M=B.attr("action");var R=E.update;var J='<div style="margin:0 auto;padding:0 1em 0;"><p style="margin:1.5em 0;white-space: nowrap;"><img src="'+E.loader+'" alt="loading" style="margin-right:.25em;" />%MESSAGE%</p></div>';var P=I("textarea[name^=comment]",B).val();P=(typeof P==="undefined"?"":P);var A=I("input[type=submit]",B).unbind("click");var T=A.val();var S=false;var H=document.images;var K=function(V,c,a,X,d){c=c||function(){};a=a||function(){};X=X||10;d=d||2000;for(var W=0,b=H.length;W<b;++W){if(H[W].src===V&&H[W].complete){c(V,H[W].width,H[W].height);return }}var Y=new Image(),Z=0;Y.finish=false;Y.onabort=Y.onerror=function(){if(Y.finish){return }Y.finish=true;a(V)};Y.onload=function(){Y.finish=true;if(I.browser.opera&&!Y.complete){a(V);return }c(V,Y.width,Y.height)};Y.src=V;if(!Y.finish&&d){setTimeout(function(){if(Y.finish){return }if(Y.complete){Y.finish=true;if(Y.width){return }a(V);return }if((Z+=X)>d){Y.finish=true;a(V);return }setTimeout(arguments.callee,X)},0)}};K(E.loader);var G=function(){T=A.val();I.scrollTo(E.form,1000,{offset:E.editOffset});B.block({message:J.replace("%MESSAGE%",E.message2),css:E.messageCSS,overlayCSS:E.overlayCSS});var V=R+"?json&comment_ID="+I(this).attr("id").replace(/^[^\d]+/,"");I.getJSON(V,function(Y){if(Y.status){I("input",B).each(function(){if(this.type=="text"||this.type=="checkbox"){this.disabled=true}});var Z=I("input[name^=author]",B),X=I("input[name^=email]",B),W=I("input[name^=url]",B);if(Z.length>0){Z.val(Y.author)[0].disabled=E.editDisabled.author}if(X.length>0){X.val(Y.email)[0].disabled=E.editDisabled.email}if(W.length>0){W.val(Y.url)[0].disabled=E.editDisabled.url}I("textarea[name^=comment]",B).val(Y.content);if(I("#comment_ID").length>0){I("#comment_ID").val(Y.id)}else{B.append(I('<input type="hidden" id="comment_ID" name="comment_ID" value="'+Y.id+'" />'))}if(I("#datetime").length>0){I("#datetime").val(Y.datetime)}else{B.append(I('<input type="hidden" id="datetime" name="datetime" value="'+Y.datetime+'" />'))}if(I("#update").length>0){I("#update").val("1")}else{B.append(I('<input type="hidden" id="update" name="update" value="1" />'))}}else{alert(Y.message)}A.val(E.editButtonLabel);B.unblock()});S=true;return false};I("a.edit-comment",Q).each(function(){I(this).unbind("click").click(G)});var L=function(W,V){switch(E.effect){case 1:Q.empty().append(W).children(":hidden").slideDown(E.speed,function(){if(N){Q.css(U)}if(O){B.css(D);I("legend",B).show()}if(V!==false){I.scrollTo(V,1000,{offset:E.editOffset})}I("a.edit-comment").each(function(){I(this).unbind("click").click(G)})});break;case 2:Q.empty().append(W).children(":hidden").fadeIn(E.speed,function(){if(N){Q.css(U)}if(O){B.css(D);I("legend",B).show()}if(V!==false){I.scrollTo(V,1000,{offset:E.editOffset})}I("a.edit-comment").each(function(){I(this).unbind("click").click(G)})});break;default:Q.animate({opacity:"hide"},E.speed,function(){I(this).empty().append(W.show()).animate({opacity:"show"},E.speed,function(){if(N){Q.css(U)}if(O){B.css(D);I("legend",B).show()}if(V!==false){I.scrollTo(V,1000,{offset:E.editOffset})}I("a.edit-comment").each(function(){I(this).unbind("click").click(G)})})});break}};var C=function(Z){B.unblock();if(O){I("legend",B).hide()}var Y=(I("#comment_ID").length>0?E.editReturn.replace("%ID%",I("#comment_ID").val()):false);var V=Z.replace(/[\r\n\t]/g,"").replace(/^.*<body ?[^>]*>(.*)<\/body>.*$/i,"$1");var d=I("#comment_count",I(V)).html();var a=I("#output_comment_count",I(V)).html();var c=(I("#last_comment_only",I(V)).html()==="TRUE");var b=I(E.list,I(V));if(Q.size()<=0){Q=b;I(E.form).prepend(Q)}var X;if(c){var W=b.children().hide();if(S){X=Q.clone();W.each(function(){var e=this.getAttribute("id");if(e!==null){X.children("#"+e).html(this.innerHTML)}});X=X.children()}else{if(d>1){X=Q.children().clone().get();W.each(function(){X.push(this)});X=I(X)}else{X=W}}}else{X=b.children().show();if(!S){switch(E.effect){case 1:case 2:X=I(I.extend(b.children().hide().get(),Q.children().get()));break}}}if(X.length>0){if(S){Q.animate({opacity:"hide"},E.speed,function(){I(this).empty().append(X.show()).animate({opacity:"show"},E.speed,function(){if(N){Q.css(U)}if(O){B.css(D);I("legend",B).show()}if(Y!==false){I.scrollTo(Y,1000,{offset:E.editOffset})}I("a.edit-comment").each(function(){I(this).unbind("click").click(G)})})})}else{if(Q.children().length<=1){switch(E.effect){case 1:Q.children().slideUp(E.speed,function(){L(X,Y)});break;case 2:Q.children().fadeOut(E.speed,function(){L(X,Y)});break;default:L(X,Y);break}}else{L(X,Y)}}I("textarea[name^=comment]",B).val("")}else{alert(Z.replace(/[\r\n\t]/g,"").replace(/^.*<body ?[^>]*>(.*)<\/body>.*$/i,"$1").replace(/<[^>]*>/,""))}I("#comment_ID").remove();I("#datetime").remove();I("#update").remove();I("#quick-comments").remove();A.val(T);S=false};var F=function(W,V,X){B.unblock();if(O){I("legend",B).hide()}alert(W.responseText.replace(/[\r\n\t]/g,"").replace(/^.*<p>(.*?)<\/p>.*$/i,"$1"));if(O){B.css(D);I("legend",B).show()}A.val(T);S=false};B.submit(function(){if(I("#quick-comments").length<=0){I(this).append('<input type="hidden" name="quick-comments" id="quick-comments" value="1" />')}var Y=I("input[name^=author]",I(this)).val();var W=I("input[name^=email]",I(this)).val();var V=I("textarea[name^=comment]",I(this)).val();Y=(typeof Y==="undefined"?"":Y);W=(typeof W==="undefined"?"":W);V=(typeof V==="undefined"?"":V);if(E.requireNameEmail&&(Y===""||W==="")){alert(E.errMsgNameEmail);return false}if(W!==""&&!(/^([a-z0-9+_]|\-|\.)+@(([a-z0-9_]|\-)+\.)+[a-z]{2,6}$/).test(W)){alert(E.errMsgEmail);return false}if(V===""||V===P){alert(E.errMsgCommentNone);return false}I("input",I(this)).each(function(){this.disabled=false});var X=(I("input#update").length>0?R:M);var Z=I("input, textarea",I(this)).serialize();I(this).block({message:J.replace("%MESSAGE%",E.message),css:E.messageCSS,overlayCSS:E.overlayCSS});I.ajax({type:"POST",cache:false,url:X,data:Z,success:C,error:F});return false})})(jQuery))};